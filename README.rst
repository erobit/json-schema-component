===================
JsonSchemaComponent
===================

This JavaScript library will

- **generate a form** from a given `JSON Schema <http://json-schema.org/>`_,
- **fill (that) form** with a JSON data structure contained in a (hidden) textarea,
- **sync changes** to the form to the data structure, and
- **display validation errors** in the form if the data structure fails to validate against the schema.

The combination of these features allows for the rapid development of instant
user interfaces for JSON APIs, e.g. in CouchDB powered back office GUIs.

You can view a demo at
https://peritus.s3.amazonaws.com/json_schema_component/demo.html

Usage
=====

Here is a simple example showing how to embed this library in your web
application::

  <!-- .. -->
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js">
  <script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js">
  <script src="path/to/json_schema_component.js">
  <script>
  new JsonSchemaComponent({
    schema: {
      properties: {
        eaten_by_whale: {
          description: "Has this thing been eaten by a whale ?",
          type: "boolean"
        }
      }
    },
    textarea: $('#mytextarea'),
    form: $('#myform')
  });
  $('#mytextarea').hide()
  </script>
  </body>
  </html>

You need to include `jQuery <http://jquery.com/>`_ (tested with 1.7.1) and
`jQuery.tmpl <https://github.com/jquery/jquery-tmpl>`_ before including
``json_schema_component.js``. If you also want to support browsers without
native JSON support, you need to include Douglas Crockford's `json2.js
<https://github.com/douglascrockford/JSON-js>`_.

Properties
++++++++++

This is a complete list of the properties ``new JsonSchemaComponent({/*
properties here*/});`` accepts:

**schema** <object> (required)
  JavaScript object containing the JSON Schema that is used to generate the
  form.

**textarea** <selector or jQuery> (required)
  The textarea containing the JSON data structure that is kept in sync with the
  form. The value of the textarea must be valid JSON.

**form** <selector or jQuery> (required if **existing_form** not specified)
  The DOM node where the form should be generated.

**existing_form** <selector or jQuery> (required if **form** not specified)
  If you want to render the form on the server side (or client-side before
  invoking JsonSchemaComponent) you can specify a form that is already in the
  DOM. JsonSchemaComponent will then only attach event handlers to update it.

**template** <string> (optional)
  The jquery.tmpl template used to generate the form using the schema. The
  default template will be used if omitted.

Validation
++++++++++

You can use garycourt's `JSV <https://github.com/garycourt/JSV>`_ to validate
the user's form input against the given schema. JsonSchemaComponent will detect
if JSV was loaded (please make sure to load ``uri.js``, ``jsv.js`` and e.g.
``json-schema-draft-03.js``) and will start validating automatically.

Form and stylesheet support
---------------------------

If there is a validation error, the containing form will get the CSS class
``error``.

For each field that fails to validate the JsonSchemaComponent will look for an
element with the id *fieldname*-error (so, e.g. ``eaten_by_whale-error`` for
the property in the introductory example) in the form (independent of whether
it's provided or generated by a template) and display the error message there.
If there is no such element, one will be generated and used at validation time.

Events
------
Because it might be beneficial to know when the form validates or not,
JsonSchemaComponent fires custom jQuery events (``validates`` and ``errors``,
respectively) on the form element every time the validation status changes.

Here is an example on how to use that to disable the submit button as long as
the form does not validate::

  var myform = $("#myform");
  var mycomponent = new JsonSchemaComponent({
    schema   : /* .. */,
    textarea : /* .. */,
    form     : myform
  });
  myform.on("validates", function() {
    myform.find("input[type=submit]").removeAttr("disabled");
  });
  myform.on("errors", function(errors) {
    // do something with the errors
    myform.find("input[type=submit]").attr("disabled", "disabled");
  });

Server side validation
----------------------

If you want to (instead of or in addition to client side validation) want to
display server side validation errors, you can do so by feeding a JSV report
compatible JavaScript object to ``setValidationReport`` like this::

  var mycomponent = new JsonSchemaComponent({
    schema   : /* .. */,
    textarea : /* .. */,
    form     : /* .. */
  });

  // this could be from ajax
  var backend_error_report = {
    errors: [{
      message : "But what's this long face about, Mr. Starbuck; wilt thou not chase the white whale!",
      details : "no specific reason",
      uri     : "/title",
    }]
  };
  mycomponent.setValidationReport(backend_error_report);

You can learn more about JSV's Report format at the "Example" section of `it's documentation <https://github.com/garycourt/JSV#readme>`_.

Note
----

Although this library performs validation, you need to apply some validation on
the server side before saving the user-provided data to your database for
security reasons.

Development
===========

To hack on this library itself (not for using this as part of your web
application), you need to clone the source code repository from GitHub like
this::

  git clone https://github.com/p7s1digital/json-schema-component.git
  cd json-schema-component

Tests
+++++

Testing this library is done using `Jasmine BDD
<http://pivotal.github.com/jasmine/>`_. You can find the test suite in
``src/json_schema_component.specs.js`` and execute the tests in your browser at
https://peritus.s3.amazonaws.com/json_schema_component/tests.html.

At the moment we know the tests work in Google Chrome, Safari, Firefox 9 and
Internet Explorer 9.

Defects and feature requests
++++++++++++++++++++++++++++

We use GitHub Issues to track defects and feature requests at
https://github.com/p7s1digital/json-schema-component/issues. To demonstrate a
certain behavior, you can link to the `demo page
<https://peritus.s3.amazonaws.com/json_schema_component/demo.html>`_ (the state
of the input values is persisted in the hash part ("``#preset=``") of the url).
Please use an `URL shortening service <http://tinyurl.com>`_ when posting such
URLs to the issue tracker.

This library does not (yet) support the complete JSON Schema specification.
Pull requests containing tests are welcome!

Changelog
=========

(unreleased)
  - support type=number and type=integer
  - gracefully render <input type=text> for type attributes not explicitly supported
  - ignore changes to inputs that are not in the schema

v0.2 - 2012-01-31
 - add validation

v0.1 - 2012-01-03
 - initial, non-public release

Legal
=====

**Authors**
  Filip Noetzel, `Lovely Systems <http://www.lovelysystems.com/>`_, Dornbirn

**License**
  TBD

**Copyright**
  |copy| 2012 by ProSiebenSat.1 Digital GmbH, Medienallee 6, 85774 Unterf√∂hring

.. |copy|   unicode:: U+000A9 .. COPYRIGHT SIGN

